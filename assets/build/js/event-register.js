/*! For license information please see event-register.js.LICENSE.txt */
(()=>{function e(){var r,n,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(e,o,a,i){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return t(l,"_invoke",function(e,t,o){var a,i,c,s=0,l=o||[],f=!1,d={p:0,n:0,v:r,a:v,f:v.bind(r,4),d:function(e,t){return a=e,i=0,c=r,d.n=t,u}};function v(e,t){for(i=e,c=t,n=0;!f&&s&&!o&&n<l.length;n++){var o,a=l[n],v=d.p,p=a[2];e>3?(o=p===t)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=r):a[0]<=v&&((o=e<2&&v<a[1])?(i=0,d.v=t,d.n=a[1]):v<p&&(o=e<3||a[0]>t||t>p)&&(a[4]=e,a[5]=t,d.n=p,i=0))}if(o||e>1)return u;throw f=!0,t}return function(o,l,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&v(l,p),i=l,c=p;(n=i<2?r:c)||!f;){a||(i?i<3?(i>1&&(d.n=-1),v(i,c)):d.n=c:d.v=c);try{if(s=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=r}else if((n=(f=d.n<0)?c:e.call(t,d))!==u)break}catch(e){a=r,i=1,c=e}finally{s=1}}return{value:n,done:f}}}(e,a,i),!0),l}var u={};function s(){}function l(){}function f(){}n=Object.getPrototypeOf;var d=[][a]?n(n([][a]())):(t(n={},a,function(){return this}),n),v=f.prototype=s.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return l.prototype=f,t(v,"constructor",f),t(f,"constructor",l),l.displayName="GeneratorFunction",t(f,i,"GeneratorFunction"),t(v),t(v,i,"Generator"),t(v,a,function(){return this}),t(v,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:p}})()}function t(e,r,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,r,n,o){function i(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?a?a(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n:(i("next",0),i("throw",1),i("return",2))},t(e,r,n,o)}function r(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("#em-event-register-form");if(t&&"undefined"!=typeof EM_AJAX){var n=t.querySelector(".em-message"),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n&&(n.textContent=e,n.classList.remove("success","error"),t&&n.classList.add(t))};t.addEventListener("submit",function(){var n,a=(n=e().m(function r(n){var a,i,c,u,s,l,f,d,v,p,m,y,g,h,b;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n.preventDefault(),a=t.querySelector('input[name="name"]'),i=t.querySelector('input[name="email"]'),c=parseInt(t.dataset.eventId,10),u=(null==a?void 0:a.value.trim())||"",s=(null==i?void 0:i.value.trim())||"",u&&s&&Number.isInteger(c)&&!(c<=0)){e.n=1;break}return o("Please fill in all required fields.","error"),e.a(2);case 1:return o(""),t.classList.add("is-loading"),l=new URLSearchParams({action:"register_event",nonce:EM_AJAX.nonce,event_id:String(c),name:u,email:s}),e.p=2,e.n=3,fetch(EM_AJAX.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:l.toString()});case 3:return f=e.v,e.p=4,e.n=5,f.json();case 5:d=e.v,e.n=7;break;case 6:return e.p=6,e.v,o("Unexpected server response.","error"),e.a(2);case 7:d.success?(o((null===(v=d.data)||void 0===v?void 0:v.message)||"Successfully registered!","success"),void 0!==(null===(p=d.data)||void 0===p?void 0:p.current_count)&&(m=t.closest(".em-single-event"),y=null==m?void 0:m.querySelector(".em-current-count"),g=null==m?void 0:m.querySelector(".em-spots-left"),y&&(y.textContent=String(d.data.current_count)),g&&(g.textContent=String(d.data.limit-d.data.current_count))),t.reset()):o((null===(h=d.data)||void 0===h?void 0:h.message)||"Something went wrong.","error"),e.n=9;break;case 8:e.p=8,b=e.v,console.error(b),o("Server error. Please try again later.","error");case 9:return e.p=9,t.classList.remove("is-loading"),e.f(9);case 10:return e.a(2)}},r,null,[[4,6],[2,8,9,10]])}),function(){var e=this,t=arguments;return new Promise(function(o,a){var i=n.apply(e,t);function c(e){r(i,o,a,c,u,"next",e)}function u(e){r(i,o,a,c,u,"throw",e)}c(void 0)})});return function(e){return a.apply(this,arguments)}}())}})})();